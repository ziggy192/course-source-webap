<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Search</title>
    <script type="text/javascript">
        function buildUri(params) {

        }
        function render(xmlHttp, xslHttp) {
            if (xmlHttp
                && xmlHttp.readyState == 4
                && xmlHttp.status == 200
                && xslHttp
                && xslHttp.readyState == 4
                && xslHttp.status == 200) {
                var xmlDoc = xmlHttp.responseXML;
                var xslDoc = xslHttp.responseXML;

                xsltProcessor = new XSLTProcessor();
                xsltProcessor.importStylesheet(xslDoc);

                //used to add to html document
                var resultDocument = xsltProcessor.transformToFragment(xmlDoc, document);
                console.log(resultDocument);
                document.getElementById("xmlResult").appendChild(resultDocument);

            }

        }

        function onBodyLoad() {

            var xsdHttp;
            var xmlHttp;

            loadXml("http://localhost:8080/course-source-webappWeb/resources/course?sort=name-up&query=huong&categoryId=5"
                , function (xmlHttpObject) {
                    xmlHttp = xmlHttpObject;

                    render(xmlHttp, xsdHttp);
                });
            loadXml("http://localhost:8080/course-source-webappWeb/xsl/search.xsl"
                , function (xmlHttpObject) {
                    xsdHttp = xmlHttpObject;
                    render(xmlHttp, xsdHttp);
                })

            // function onReadyStateChange() {
            //     switch (xmlHttp.readyState) {
            //         case 0:
            //             //not initialized
            //             break;
            //         case 1:
            //             //connection establised
            //             break;
            //         case 2:
            //             //request received
            //             break;
            //         case 3:
            //             //answer in progress
            //             break;
            //         case 4:
            //             //finished
            //             if (xmlHttp.status == 200) {
            //                 render(xmlHttp, xslHttp)
            //
            //             } else {
            //                 console.error("Error xmlHttp:", xmlHttp.statusText)
            //             }
            //             break;
            //
            //
            //     }
            //
            // }

            function loadXml(url, handlerWhenSucess) {
                var xmlHttp = getXmlHttpObject();
                xmlHttp.open("GET", url, true);
                // xmlHttp.responseType = 'document';
                xmlHttp.onreadystatechange = function () {
                    if (xmlHttp.readyState == 4) {
                        if (xmlHttp.status == 200) {

                            console.log('url=' + url + '\n response=' + xmlHttp.response);
                            console.log('url=' + url + '\n responsexml=' + xmlHttp.responseXML);
                            console.log('url=' + url + '\n resonseXMLCount=' + xmlHttp.responseXML.documentElement.childElementCount)
                            handlerWhenSucess(xmlHttp);

                        }
                        else {
                            console.error("Error on loadXml() | url=" + url + " | status=" + xmlHttp.statusText);
                        }
                    }
                }
                xmlHttp.send(null);


            }

            function getXmlHttpObject() {
                var xmlHttp = null;
                if (window.XMLHttpRequest) {
                    //for modern browser
                    xmlHttp = new XMLHttpRequest();
                } else {
                    xmlHttp = new ActiveXObject("Microsoft.XMLHTTP");
                }
                return xmlHttp;
            }
        }

    </script>
</head>
<body onload="onBodyLoad()">
<h1>Search Engine</h1>
<form method="post" action="/search">
    <input type="text" name="query" value=""/>
    <br/>
    <input type="submit" value="Search">

</form>
<div id="xmlResult"></div>
</body>
</html>